<!DOCTYPE html>
<html>
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
        <meta name="author" content="Jamsa" />
        <meta name="robots" content="index, follow"/>

        <meta property="og:title" content="Sed Tips"/>
        <meta property="og:url" content="./sed-tips.html"/>
        <meta property="og:site_name" content="Jamsa的笔记"/>
        <meta property="og:type" content="article"/>

        <link rel="canonical" href="./sed-tips.html" />

        <title>Sed Tips | Jamsa的笔记</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">

        <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css" />
        <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/css/bootstrap-combined.min.css" />
        

        <link rel="stylesheet" type="text/css" href="./theme/css/main.css" />

        <script type="text/javascript">var switchTo5x=true;</script>
        <script type="text/javascript" src="http://w.sharethis.com/button/buttons.js"></script>
        <script type="text/javascript">
         stLight.options({
             publisher: "",
             doNotHash: false,
             doNotCopy: false,
             hashAddressBar: false
         });
        </script>
    </head>

    <body id="index">
        <div class="row-fluid">
            <div class="span10 offset1">
                <header id="banner" >
                    <h1>
                        <a href="./">Jamsa的笔记 </a>
                    </h1>
                    <nav class="navbar">
                        <div class="navbar-inner">
                            <ul class="nav">
                                <li ><a href="./category/da-shu-ju.html">大数据</a></li>
                                <li ><a href="./category/fang-fa.html">方法</a></li>
                                <li ><a href="./category/ji-qi-xue-xi.html">机器学习</a></li>
                                <li ><a href="./category/kai-fa.html">开发</a></li>
                                <li ><a href="./category/qian-duan.html">前端</a></li>
                                <li class="active"><a href="./category/xiao-lu.html">效率</a></li>
                                <li ><a href="./category/yi-dong.html">移动</a></li>
                            </ul>

                        </div>
                    </nav>
                </header><!-- /#banner -->
            </div>
        </div>

        <div class="row-fluid">
            <div class="span10 offset1">
                <div class="row-fluid">
<div class="span10 offset1">
  <section>
    <article>
      <header>
        <h1 class="entry-title">
          <a href="./sed-tips.html" rel="bookmark"
             title="Permalink to Sed Tips">Sed Tips</a></h1>
      </header>
      <div class="entry-content">
<footer class="post-info">
    <address class="vcard author">
        by <a class="url fn" href="./author/jamsa.html">Jamsa</a>
    </address>

    in <a href="./category/xiao-lu.html">效率</a>

    on 2007-06-19

        |
        tags:         <a href="./tag/linux.html">linux</a>
        <a href="./tag/sed.html">sed</a>


        |
        <a href="./sed-tips.html#disqus_thread">comments</a>

    
</footer><!-- /.post-info -->

        <h1>I介绍</h1>
<h2>1. sed可以完成的工作</h2>
<p>sed最常用在编辑那些需要不断重复某些编辑动作的文件上。</p>
<p>可以用sed完成一些重复性的工作。</p>
<p>sed可以一次执行多个不同的编辑动作。</p>
<h2>2. sed能做哪些编辑动作</h2>
<p>删除、修改、添加、插入、合并文件中的资料行，或读入其它文件的资料到文件中，也可以替换其中的字符串、转换其中的字母等。</p>
<h2>3. sed工作流程</h2>
<p>从输入中读入内容，操作完毕后发送到标准输出。</p>
<h1>II使用sed</h1>
<p>sed命令可以分成编辑指令与文件指令两部分。编辑指令负责控制所有编辑工作，文件指令处理文件。编辑指令由位址与函数两部分组件，位址指令用于定位对象，而编辑指令用于编辑对象。</p>
<h2>1. 命令行上的编辑指令</h2>
<p>在命令行上执行sed指令时用-e参数，如果sed指令在文件中用-f参数。</p>
<div class="highlight"><pre><span></span>sed -e '编辑指令1' -e '编辑指令2' ...文件一 ...文件二
</pre></div>
<p>例</p>
<div class="highlight"><pre><span></span>sed -e '1,10d' -e 's/yellow/black/g' yel.dat
</pre></div>
<p>在面的命令中'1,10d'执行删除1到10行，s/yellow/black/g'将yellow字符串替换成black字符串。</p>
<h2>2. 编辑指令的格式如下：</h2>
<div class="highlight"><pre><span></span>[address1[,address2]]function[argument]
</pre></div>
<p>address1,address2为行数或者正则表达式，用于定位所编辑的对象。function[argument]为sed的内置函数，表示在对象上执行的动作。</p>
<h2>3. 定位(address)参数的表示方法：</h2>
<p>下面举例以使用函数参数d为例：</p>
<p>a. 删除文件内第10行的内容，则指令为10d</p>
<p>b. 删除含有'man'字符串的行，指令为/man/d</p>
<p>c. 删除文件内第10行到第20行，为10,20d</p>
<p>d. 删除第10行到含有'man'字符串的行，则指令为10,/man/d</p>
<p>定位参数的说明：</p>
<p>a. 定位参数为十进制数字：此数字表示行数。</p>
<p>b. 定位参数为正则表达式，当输入中有符合该表达式时，执行编辑动作。</p>
<h2>4. 函数参数</h2>
<p>函數參數    功能</p>
<div class="highlight"><pre><span></span>: label     建立 script file 內指令互相參考的位置。 
#   建立註解 
{ }     集合有相同位址參數的指令。 
!   不執行函數參數。 
=   印出資料行數( line number )。 
a\  添加使用者輸入的資料。 
b label     將執行的指令跳至由 : 建立的參考位置。 
c\  以使用者輸入的資料取代資料。
d   刪除資料。 
D   刪除 pattern space 內第一個 newline 字母 \ 前的資料。 
g   拷貝資料從 hold space。 
G   添加資料從 hold space 至 pattern space 。 
h   拷貝資料從 pattern space 至 hold space 。 
H   添加資料從 pattern space 至 hold space 。 
l   印出 l 資料中的 nonprinting character 用 ASCII 碼。 
i\  插入添加使用者輸入的資料行。 
n   讀入下一筆資料。 
N   添加下一筆資料到 pattern space。 
p   印出資料。 
P   印出 pattern space 內第一個 newline 字母 \ 前的資料。 
q   跳出 sed 編輯。 
r   讀入它檔內容。 
s   替換字串。 
t label     先執行一替換的編輯指令 , 如果替換成牛p&gt;則將編輯指令跳至 : label 處執行。 
w   寫資料到它檔內。 
x   交換 hold space 與 pattern space 內容。 
y   轉換(transform)字元。
</pre></div>
<h2>5. 执行文件中的编辑指令</h2>
<p>当执行的指令过多时，可以将指令放到文件中。用sed -f script_file执行。</p>
<div class="highlight"><pre><span></span>    sed -f script_file ...文件
</pre></div>
<p>例如：</p>
<div class="highlight"><pre><span></span>    sed -f ysb.scr yel.dat
</pre></div>
<p>其中，ysb.scr的内容如下：</p>
<div class="highlight"><pre><span></span>1,10d
s/yellow/black/g
</pre></div>
<h2>6. 执行多个文件的编辑</h2>
<p>在sed命令行上，一次可以执行编辑多个文件，例如：</p>
<div class="highlight"><pre><span></span>    sed -e 's/yellow/blue/g' white.dat red.dat black.dat
</pre></div>
<p>sed将从左至右依次处理各个文件。</p>
<h2>7. 执行输出控制</h2>
<p>默认情况下处理后的结果输出到标准输出。但通过-n，可以将输出的控制权交给sed，由编辑指令来决定结果是否输出。</p>
<p>例如：</p>
<div class="highlight"><pre><span></span>    sed -n -e '/white/p' white.dat
</pre></div>
<p>上例中-n与编辑指令/white/p一起配合控制输出。-n将输出控制权交给编辑指令，/white/p将含有'white'的字符串打印出来。</p>
<h1>III范例</h1>
<p>操作需求描述：</p>
<div class="highlight"><pre><span></span>    将文件中...资料，执行...(动作)
</pre></div>
<p>当需要执行多个动作时，指令形式如下：</p>
<div class="highlight"><pre><span></span>    位置参数{
        函数参数1
        函数参数2
        函数参数3
         .
         .
        }
</pre></div>
<h2>1. 替换文件中的资料</h2>
<p>a. 将文件中含'machine'字符串的资料选中的'phi'字符串替换成'beta'字符串</p>
<div class="highlight"><pre><span></span>    sed -e '/machine/s/phi/beta/g' input.dat
</pre></div>
<p>b. 将文件中第5行资料，替换成'This is a test.'</p>
<div class="highlight"><pre><span></span>    sed -e '5c\
    This is a test.
    ' input.dat
</pre></div>
<p>c. 将文件中1至100行的资料替换成如下两行：</p>
<div class="highlight"><pre><span></span>    How are you?
    data be deleted!
</pre></div>
<p>则命令如下：</p>
<div class="highlight"><pre><span></span>    sed -e '1,100c\
    How are you?\
    data be deleted!
    ' input.dat
</pre></div>
<h2>2. 移动文件中的资料</h2>
<p>可以使用sed中的hold space暂存编辑中的资料，用函数w将文件资料搬到它档内存储，或者用函数r半它档内容搬到文件内。当执行函数参数h,H时会将pattern space资料暂存到hold space,当执行x,g,G时，会将暂存的资料取到pattern space</p>
<p>a. 将文件中前100行，搬到文件第300行后。</p>
<div class="highlight"><pre><span></span>    sed -f mov.src 文件
</pre></div>
<p>mov.src 内容如下：</p>
<div class="highlight"><pre><span></span>1,100{
H
d
}
300G
</pre></div>
<p>其中</p>
<div class="highlight"><pre><span></span>1,100{
H
d
}
</pre></div>
<p>表示将文件前100行，先储存在hold space之后删除。指令300G表示将hold space内的资料，添加在第300行后输出。</p>
<p>b. 将文件中含'phi'字符串的行，搬至mach.inf中：</p>
<div class="highlight"><pre><span></span>    sed -e '/phi/w mach.inf' 文件名
</pre></div>
<p>c. 将mach.inf中的内容，移到文件中含'beta'字符串的行：</p>
<div class="highlight"><pre><span></span>    sed -e '/beta/r march.inf' 文件名
</pre></div>
<p>另外由于sed是一个流编辑器，理论上输出后的文件资料不可能再搬回来编辑。</p>
<h2>3. 删除文件中的资料</h2>
<p>因为sed是行编辑器，所以sed很容易删除行，或者整个资料。一般用d或D来删除。</p>
<p>a. 将文件内的所有空白行全部删除：</p>
<div class="highlight"><pre><span></span>    sed -e '/^$/d' 文件名
</pre></div>
<p>正则表达式中'^<span class="math">\('表示空白，'^'表示行开头，'\)</span>'表示行结尾。</p>
<p>b. 将文件内连续的空白行，删除成一行：</p>
<div class="highlight"><pre><span></span>    sed -e '/^$/{
    N
    /^$/D
    }' 文件名
</pre></div>
<p>其中N表示将空白的下一行资料加至pattern space内。函数参数/^$/D表示，当添加的是空白行时，删除第一行空白行，而且剩下的空白行则再重新执行一次指令。如此反复，最后只留下一行空白行了。</p>
<h2>4. 搜索文件中的资料</h2>
<p>sed可以执行类似UNIX命令grep的功能。理论上可以用正则表达式将文件中匹配的内容输出。</p>
<p>例如将文件中包含'gamma'的内容输出</p>
<div class="highlight"><pre><span></span>    sed -n -e '/gamma/p' 文件名
</pre></div>
<p>但sed是行编辑器，它搜寻基本上是以行为单位。因此，当一些字符串因换行被拆分成两部分时，一般的方法即不可行。此时，就必须以合并行的方式来搜寻这些资料。例：</p>
<p>将文件中仿'omega'字符串的资料输出。其命令如下：</p>
<div class="highlight"><pre><span></span>    sed -f gp.scr 文件名
</pre></div>
<p>gp.scr内容如下：</p>
<div class="highlight"><pre><span></span>/omega/b
N
h
s/.*\n//
/omega/b
g
D
</pre></div>
<p>在上述sed script中，因函数参数b形成类似C语言中的case结构，使得sed可以分别处理当资料内含'omega'字串，当'omega'字符串被拆成两行，以及资料内没有'omega'字串的情况。下面分三种情况讨论：</p>
<p>a. 当资料内仿'omega'，则执行编辑指令</p>
<div class="highlight"><pre><span></span>/omega/b
</pre></div>
<p>它表示当资料内含有'omega'字符串时，sed不再执行它后面的指令，而直接将它输出。</p>
<p>b. 当资料内没有'omega'，则执行编辑指令如下：</p>
<div class="highlight"><pre><span></span>N
h
s/.*\n//
/omega/b
</pre></div>
<p>其中，函数参数N，表示将下一行资料读入使得pattern space内含前后两行资料。函数参数h表示将pattern space内的前后两行资料存入hold space。函数参数s/.*\n//，它表示将pattern space内的前后两行资料进行合并成一行。/omega/b，它表示如果合并后的资料内含'omega'字符串，则不再执行后面的指令，而将此资料自动输出。</p>
<p>c. 当合并后的资料依旧不含'omega'，则执行编辑指令如下</p>
<div class="highlight"><pre><span></span>g
D
</pre></div>
<p>其中，函数参数g，它表示将hold space内合并前的两行资料放回pattern space。函数参数D，它表示删除两行资料中的第一行资料，并让剩下的那行资料，重新执行sed script。如此，无论是资料行内或行间的字符串都可以搜索到。</p>
<script type="text/javascript">if (!document.getElementById('mathjaxscript_pelican_#%@#$@#')) {
    var align = "center",
        indent = "0em",
        linebreak = "false";

    if (false) {
        align = (screen.width < 768) ? "left" : align;
        indent = (screen.width < 768) ? "0em" : indent;
        linebreak = (screen.width < 768) ? 'true' : linebreak;
    }

    var mathjaxscript = document.createElement('script');
    var location_protocol = (false) ? 'https' : document.location.protocol;
    if (location_protocol !== 'http' && location_protocol !== 'https') location_protocol = 'https:';
    mathjaxscript.id = 'mathjaxscript_pelican_#%@#$@#';
    mathjaxscript.type = 'text/javascript';
    mathjaxscript.src = location_protocol + '//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML';
    mathjaxscript[(window.opera ? "innerHTML" : "text")] =
        "MathJax.Hub.Config({" +
        "    config: ['MMLorHTML.js']," +
        "    TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], equationNumbers: { autoNumber: 'AMS' }, Macros: {} }," +
        "    jax: ['input/TeX','input/MathML','output/HTML-CSS']," +
        "    extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js']," +
        "    displayAlign: '"+ align +"'," +
        "    displayIndent: '"+ indent +"'," +
        "    showMathMenu: true," +
        "    messageStyle: 'normal'," +
        "    tex2jax: { " +
        "        inlineMath: [ ['\\\\(','\\\\)'] ], " +
        "        displayMath: [ ['$$','$$'] ]," +
        "        processEscapes: true," +
        "        preview: 'TeX'," +
        "    }, " +
        "    'HTML-CSS': { " +
        "        styles: { '.MathJax_Display, .MathJax .mo, .MathJax .mi, .MathJax .mn': {color: 'inherit ! important'} }," +
        "        linebreaks: { automatic: "+ linebreak +", width: '90% container' }," +
        "    }, " +
        "}); " +
        "if ('default' !== 'default') {" +
            "MathJax.Hub.Register.StartupHook('HTML-CSS Jax Ready',function () {" +
                "var VARIANT = MathJax.OutputJax['HTML-CSS'].FONTDATA.VARIANT;" +
                "VARIANT['normal'].fonts.unshift('MathJax_default');" +
                "VARIANT['bold'].fonts.unshift('MathJax_default-bold');" +
                "VARIANT['italic'].fonts.unshift('MathJax_default-italic');" +
                "VARIANT['-tex-mathit'].fonts.unshift('MathJax_default-italic');" +
            "});" +
            "MathJax.Hub.Register.StartupHook('SVG Jax Ready',function () {" +
                "var VARIANT = MathJax.OutputJax.SVG.FONTDATA.VARIANT;" +
                "VARIANT['normal'].fonts.unshift('MathJax_default');" +
                "VARIANT['bold'].fonts.unshift('MathJax_default-bold');" +
                "VARIANT['italic'].fonts.unshift('MathJax_default-italic');" +
                "VARIANT['-tex-mathit'].fonts.unshift('MathJax_default-italic');" +
            "});" +
        "}";
    (document.body || document.getElementsByTagName('head')[0]).appendChild(mathjaxscript);
}
</script>

      </div><!-- /.entry-content -->
      <div class="comments">
        <h2>Comments</h2>
        <div id="disqus_thread"></div>
        <script type="text/javascript">
          var disqus_identifier = "sed-tips.html";
          (function() {
          var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
          dsq.src = '//jamsa-github-io.disqus.com/embed.js';
          (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
          })();
        </script>
      </div>

    </article>
  </section>
</div>
                </div>
            </div>
        </div>

        <footer id="site-footer">
            <div class="row-fluid">
                <div class="span10 offset1">
                    <address>
                        <p>
                        This blog is proudly powered by <a href="http://getpelican.com/">Pelican</a>, which takes great advantage of <a href="http://python.org">Python</a>.
                        </p>
                        <p>
                            <a href="http://github.com/jsliang/pelican-fresh/">Fresh</a> is a responsive theme designed by <a href="http://jsliang.com/">jsliang</a> and <a href="https://github.com/jsliang/pelican-fresh/graphs/contributors">contributors</a>.
                        Special thanks to <a href="http://coding.smashingmagazine.com/2009/08/04/designing-a-html-5-layout-from-scratch/">Smashing Magazine</a> and <a href="http://getbootstrap.com/">Twitter Bootstrap</a>.
                        </p>
                    </address>
                </div>
            </div>
        </footer>

<script type="text/javascript">
    var disqus_shortname = 'jamsa-github-io';
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = '//' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>
        <script src="https://code.jquery.com/jquery-2.2.4.min.js"></script>
        <script src="//netdna.bootstrapcdn.com/bootstrap/2.3.2/js/bootstrap.min.js"></script>

        <link href="http://apps.bdimg.com/libs/highlight.js/9.1.0/styles/default.min.css" rel="stylesheet">
        <script src="http://apps.bdimg.com/libs/highlight.js/9.1.0/highlight.min.js"></script>
        <script>hljs.initHighlightingOnLoad();</script>
</body>
</html>